<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IoT Water Dashboard</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;500&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #e0e5ec; --shadow: #a3b1c6; --light: #ffffff; --primary: #4a90e2; --danger: #e74c3c; --success: #2ecc71; }
        body { background-color: var(--bg); font-family: 'Kanit', sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; color: #444; }
        .container { width: 90%; max-width: 400px; padding: 30px; background: var(--bg); border-radius: 30px; box-shadow: 20px 20px 60px var(--shadow), -20px -20px 60px var(--light); text-align: center; }
        .card { margin: 15px 0; padding: 15px; border-radius: 20px; box-shadow: inset 6px 6px 12px var(--shadow), inset -6px -6px 12px var(--light); }
        .value { font-size: 2.2rem; font-weight: bold; color: var(--primary); display: block; }
        .label { font-size: 0.85rem; color: #777; }
        
        /* ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î */
        .btn-toggle {
            width: 80px; height: 80px; border-radius: 50%; border: none; background: var(--bg);
            box-shadow: 6px 6px 12px var(--shadow), -6px -6px 12px var(--light);
            cursor: pointer; transition: 0.3s; margin-top: 20px; outline: none;
        }
        .btn-toggle:active { box-shadow: inset 4px 4px 8px var(--shadow), inset -4px -4px 8px var(--light); }
        .btn-on { color: var(--success); }
        .btn-off { color: var(--danger); }
    </style>
</head>
<body>

<div class="container">
    <h2>Water Monitoring</h2>
    
    <div class="card">
        <span class="label">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏≠‡∏≤‡∏Å‡∏≤‡∏®</span>
        <span id="temp" class="value">--</span><span class="label">¬∞C</span>
    </div>

    <div class="card">
        <span class="label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ó‡∏ò‡πå</span>
        <span id="hum" class="value">--</span><span class="label">% RH</span>
    </div>

    <div class="card">
        <span class="label">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥ (‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á)</span>
        <span id="dist" class="value">--</span><span class="label">cm</span>
    </div>

    <button id="buzzerBtn" class="btn-toggle btn-on" onclick="toggleBuzzer()">
        <span id="buzzerIcon" style="font-size: 30px;">üîä</span>
        <span id="buzzerText" class="label">‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏≠‡∏¢‡∏π‡πà</span>
    </button>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCGbFF56TFOq2QhoROsBaCXAMEf9I6hmPw",
        authDomain: "uset1-d74f2.firebaseapp.com",
        databaseURL: "https://uset1-d74f2-default-rtdb.firebaseio.com",
        projectId: "uset1-d74f2",
        storageBucket: "uset1-d74f2.firebasestorage.app",
        messagingSenderId: "777746620640",
        appId: "1:777746620640:web:6b683c0e748ef08c7b7085"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentBuzzerState = 1; // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î (1)

    // ‡∏ü‡∏±‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å Firebase ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
    db.ref('WaterProject').on('value', (snapshot) => {
        const data = snapshot.val();
        if(data) {
            document.getElementById('temp').innerText = data.temperature ? data.temperature.toFixed(1) : "--";
            document.getElementById('hum').innerText = data.humidity ? data.humidity.toFixed(1) : "--";
            document.getElementById('dist').innerText = data.distance ? data.distance.toFixed(1) : "--";
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏≤‡∏Å Firebase
            if(data.buzzerStatus !== undefined) {
                currentBuzzerState = data.buzzerStatus;
                updateButtonUI(currentBuzzerState);
            }
        }
    });

    function toggleBuzzer() {
        const newState = currentBuzzerState === 1 ? 0 : 1;
        db.ref('WaterProject/buzzerStatus').set(newState);
    }

    function updateButtonUI(state) {
        const btn = document.getElementById('buzzerBtn');
        const icon = document.getElementById('buzzerIcon');
        const text = document.getElementById('buzzerText');
        
        if(state === 1) {
            btn.className = "btn-toggle btn-on";
            icon.innerText = "üîä";
            text.innerText = "‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏≠‡∏¢‡∏π‡πà";
            text.style.color = "#2ecc71";
        } else {
            btn.className = "btn-toggle btn-off";
            icon.innerText = "üîá";
            text.innerText = "‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏≠‡∏¢‡∏π‡πà";
            text.style.color = "#e74c3c";
        }
    }
</script>
</body>
</html>
